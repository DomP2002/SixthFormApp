<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="./javascript/jquery-3.2.1.min.js"></script>
		<script src="./javascript/js.cookie.js"></script>
		<script src="./javascript/query.js"></script>
		<script src="cordova.js"></script>
		<link href="./css/styles.css" rel="stylesheet" type="text/css">
		<script>
			function loadPage() {
				query("/fetch/links/list/", {"validOnly": true}, function(data) {
					loadlinks(data);
				}, function(data) {
					alert(data);
				});
			}

			function loadlinks(data) {
				$("#ltl").empty();
				$("#perm").empty();
				$.each(data["content"]["records"], function(index, item){
					var storedDate = item["ExpiryDate"];
					var link = "javascript:openInBrowser('" + item["Link"] + "')";

					if(storedDate == 2147483647) {
						$("#perm").append('<a href="' + link + '">' + item["Name"] + '</a><br>');
					} else {
						var date = new Date(storedDate * 1000);
				    var displayDate = date.getDate() + "/" + (date.getMonth() + 1) + "/" + (date.getYear() + 1900);
						var displayTime = date.getHours() + ":" + date.getMinutes();
						$("#ltl").append('<a href="' + link + '">' + item["Name"] + '</a> (expires on ' + displayDate + ' at ' + displayTime + ')<br>');
					}
				});
			}
		</script>
	</head>
	<body>
		<div class="menu">
			<nav>
				<ul>
					<a href="home.html"><li>Home</li></a>
					<a href="notices.html"><li>Notices</li></a>
					<li class="current">Links</li>
					<a href="newsletters.html"><li>Newsletters</li></a>
				</ul>
			</nav>
		</div>
		<div class="content">
			<h1 class="header">Important Links</h1>
			<br>
			<h2>Limited Time Links</h2>
			<br>
			<div id="ltl">
			</div>
			<br>
			<h2>Permanent Links</h2>
			<br>
			<div id="perm">
			</div>
		</div>
	</body>
</html>
