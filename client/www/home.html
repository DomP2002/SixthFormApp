<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="Content-Language" content="en-gb">
		<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

		<title>Home</title>

		<script src="./javascript/jquery-3.2.1.min.js"></script>
		<script src="./javascript/js.cookie.js"></script>
		<script src="./javascript/query.js"></script>
		<script src="cordova.js"></script>
		<link href="./css/styles.css" rel="stylesheet" type="text/css">

		<script>
			if(!isLoggedIn()) {
			  window.location = "index.html";
			}

			$(document).ready(function () {
				search(null);

				$("#search").click(function (e) {
					e.preventDefault();
					var value = $("#contains").val();
					search(value);
				});

				$("#reset").click(function (e) {
					e.preventDefault();
					$("#contains").val("");
					search(null);
				})
			});

			function search(parameter) {
				query("/fetch/announcements/list/", {"limit": 10, "contains": parameter}, function(data) {
					loadAnnouncements(data);
				}, function(data) {
					alert(data);
				});
			}

			function loadAnnouncements(data) {
				$("#announcements").empty();
				$.each(data["content"]["records"], function(index, item){
					var date = new Date(item["DateAdded"] * 1000);
			    var displayDate = date.getDate() + "/" + (date.getMonth() + 1) + "/" + (date.getYear() + 1900) + " " + date.getHours() + ":" + date.getMinutes();

					$("#announcements").append('<div class="announcement"><h2 class="title">' + item["Title"] + '</h2><p class="added">Added ' + displayDate + '</p><p>' + item["Content"] + '</p></div><br>');
				});
			}
		</script>
	</head>
	<body>
		<div class="menu">
			<nav>
				<ul>
					<li class="current">Home</li>
					<a href="notices.html"><li>Notices</li></a>
					<a href="links.html"><li>Links</li></a>
					<a href="newsletters.html"><li>Newsletters</li></a>
				</ul>
			</nav>
		</div>
		<div class="content">
			<h1 class="header">Announcements</h1>
			<h2>Search</h2>
			<p>Contains: <input type="text" id="contains"></p>
			<button id="search">Search</button> <button id="reset">Reset</button>
			<br>
			<br>
			<div id="announcements">
			</div>
		</div>
	</body>
</html>
