<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="./javascript/jquery-3.2.1.min.js"></script>
		<script src="./javascript/js.cookie.js"></script>
		<script src="./javascript/query.js"></script>
		<script src="cordova.js"></script>
		<link href="./css/styles.css" rel="stylesheet" type="text/css">
		<script>
			function loadPage() {
				query("/fetch/files/notices/latest/", {}, function(data) {
					loadLatest(data);
				}, function(data) {
					alert(data);
				});

				query("/fetch/files/notices/list/", {validOnly: true}, function(data) {
					loadNotices(data);
				}, function(data) {
					alert(data);
				});
			}

			function loadLatest(data) {
				if(data["content"]["found"] == false) {
					return;
				}

				var latest = data["content"]["latest"];
				$("#latest_name").text(latest["Name"]);
				var link = "javascript:openInBrowser('" + Cookies.get("resource_base") + latest["Link"] + "')";
				$("#latest_link").attr("href", link);
			}

			function loadNotices(data) {
				if(data["content"]["found"] == false) {
					return;
				}

				console.log(data);

				$.each(data["content"]["records"], function(index, item){
					var expiryDate = item["ExpiryDate"];

					if(expiryDate == 2147483647) {
						expiryDate = "Never";
					} else {
						expiryDate = new Date(expiryDate * 1000);
						expiryDate = expiryDate.getDate() + "/" + (expiryDate.getMonth() + 1) + "/" + (expiryDate.getYear() + 1900);
					}

					var addedDate = new Date(item["AddedDate"] * 1000);
					addedDate = addedDate.getDate() + "/" + (addedDate.getMonth() + 1) + "/" + (addedDate.getYear() + 1900);

					var link = "javascript:openInBrowser('" + Cookies.get("resource_base") + item["Link"] + "')";

					$("#notices_table > tbody").append('<tr><td>' + item["Name"] + '</td><td>' + addedDate + '</td><td>' + expiryDate + '</td><td><a href="' + link + '">View</a></td></tr>');
				});
			}
		</script>
	</head>
	<body>
		<div class="menu">
			<nav>
				<ul>
					<a href="home.html"><li>Home</li></a>
					<li class="current">Notices</li>
					<a href="links.html"><li>Links</li></a>
					<a href="newsletters.html"><li>Newsletters</li></a>
				</ul>
			</nav>
		</div>
		<div class="content">
			<h1 class="header">Daily Sixth Form Notices</h1>
			<strong><a style="font-size: 18px; text-align: center" id="latest_link"><p>View Latest Notices (<span id="latest_name"></span>)</p></a></strong>
			<h2>Older Notices</h2>
			<table id="notices_table" class="data-table">
				<thead>
					<tr><th>Name</th><th>Added</th><th>Expires</th><th>View File</th></tr>
				</thead>
				<tbody>
				</tbody>
			</table>
			<br>
		</div>
	</body>
</html>
