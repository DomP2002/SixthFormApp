<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="./javascript/jquery-3.2.1.min.js"></script>
		<script src="./javascript/js.cookie.js"></script>
		<script src="./javascript/query.js"></script>
		<script src="cordova.js"></script>

		<link href="./css/styles.css" rel="stylesheet" type="text/css">

		<script>
			if(!isLoggedIn()) {
			  window.location = "index.html";
			}

			$(document).ready(function () {
				query("/fetch/files/newsletters/latest/", {}, function(data) {
					loadLatest(data);
				}, function(data) {
					alert(data);
				});

				query("/fetch/files/newsletters/list/", {"limit": 10}, function(data) {
					loadNewsletters(data);
				}, function(data) {
					alert(data);
				});
			});

			function loadLatest(data) {
				var latest = data["content"]["latest"];
				$("#latest_name").text(latest["Name"]);
				$("#latest_link").attr("href", Cookies.get("resource_base") + latest["Link"]);
			}

			function loadNewsletters(data) {
				$.each(data["content"]["records"], function(index, item){
					var expiryDate = item["ExpiryDate"];
					var addedDate = item["AddedDate"];
				});
			}
		</script>
	</head>
	<body>
		<div class="menu">
			<nav>
				<ul>
					<a href="home.html"><li>Home</li></a>
					<a href="notices.html"><li>Notices</li></a>
					<a href="links.html"><li>Links</li></a>
					<li class="current">Newsletters</li>
				</ul>
			</nav>
		</div>
		<div class="content">
			<h1>Newsletters</h1>
			<strong><a style="font-size: 18px; text-align: center" id="latest_link"><p>View Latest Newsletter (<span id="latest_name"></span>)</p></a></strong>
			<h2>Older Newsletters</h2>
			<table id="newsletter_table">
				<thead>
					<tr><th>Name</th><th>Date Added</th><th>Expiry Date</th><th>View File</th></tr>
				</thead>
				<tbody>
				</tbody>
			</table>
			<br>
		</div>
</body>
</html>
